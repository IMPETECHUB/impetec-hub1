<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orden de Servicio - IMPETEC</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #2c3e50; 
            --accent: #2980b9; 
            --bg-body: #f0f3f6; 
            --success: #27ae60; 
            --warning: #f1c40f;
            --danger: #e74c3c;
        }
        
        @page { size: A4; margin: 0; }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-body); 
            margin: 0; padding: 20px; color: #333; 
        }

        .toolbar {
            max-width: 800px; margin: 0 auto 10px auto; background: white; padding: 10px;
            border-radius: 8px; display: flex; gap: 10px; align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .btn { padding: 6px 12px; border-radius: 4px; border: 1px solid #ccc; font-size: 11px; cursor: pointer; font-weight: bold; }
        .btn-save { background: #27ae60; color: white; border: none; }
        .btn-pdf { background: var(--primary); color: white; border: none; }

        #invoice {
            width: 210mm;
            height: 296mm; 
            margin: auto; 
            background: white; 
            padding: 15mm; 
            box-sizing: border-box; 
            display: flex; 
            flex-direction: column;
            overflow: hidden; 
        }

        .header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
        
        .logo-placeholder {
            width: 180px; height: 60px; border: 1px dashed #ccc;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
        }
        .logo-placeholder img { max-width: 100%; max-height: 100%; object-fit: contain; }

        .order-badge { background: var(--primary); color: white; padding: 5px 12px; border-radius: 4px; font-weight: bold; font-size: 1.1em; display: inline-block; }

        .grid-tech { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px; }
        .span-2 { grid-column: span 2; }
        
        .input-card { border: 1px solid #e1e8ed; padding: 8px; border-radius: 4px; background: #fdfdfd; cursor: text; }
        .input-card label { display: block; font-size: 0.65em; font-weight: bold; color: var(--accent); text-transform: uppercase; margin-bottom: 2px; cursor: default; }
        
        /* Asegura que el Ã¡rea de escritura sea visible y clickeable */
        .editable-field { 
            display: block; 
            width: 100%; 
            min-height: 1.2em; 
            outline: none; 
            font-size: 0.9em;
            font-weight: 500;
        }

        .prio-normal { border-left: 4px solid var(--success); }
        .prio-basico { border-left: 4px solid var(--warning); }
        .prio-urgencia { border-left: 4px solid var(--danger); }

        .info-block { margin-top: 10px; padding: 8px 12px; border-left: 3px solid var(--accent); background: #fcfcfc; }
        .info-block h4 { margin: 0 0 5px 0; font-size: 0.75em; text-transform: uppercase; color: var(--primary); }
        
        .materiales-header {
            background: #f8f9fa; color: var(--primary); padding: 8px; 
            font-size: 0.8em; font-weight: bold; border-bottom: 2px solid var(--primary);
            margin-top: 15px;
        }
        
        .espacio-blanco { 
            flex-grow: 1; 
            padding: 10px; 
            font-size: 0.9em;
            border: 1px solid #eee;
            margin-bottom: 10px;
            outline: none;
        }

        .sig-container { 
            margin-top: 20px; 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 60px; 
            padding-bottom: 10px;
        }
        .sig-box { text-align: center; border-top: 1px solid #333; padding-top: 5px; font-size: 0.8em; }

        @media print {
            .toolbar, .no-print { display: none !important; }
            body { background: white; padding: 0; margin: 0; }
            #invoice { box-shadow: none; margin: 0; width: 100%; height: 100vh; padding: 10mm; }
            .logo-placeholder { border: none; }
        }
    </style>
</head>
<body>

<div class="toolbar no-print">
    <div style="display: flex; gap: 15px; align-items: center;">
        <label style="font-size: 11px; font-weight: bold;">PRIORIDAD:</label>
        <select id="prioritySelect" class="btn" onchange="updatePriority()">
            <option value="normal">Normal</option>
            <option value="basico">BÃ¡sico</option>
            <option value="urgencia">Urgencia</option>
        </select>
    </div>
    <div style="margin-left: auto; display: flex; gap: 8px;">
        <button class="btn btn-save" onclick="saveHTML()">ðŸ’¾ GUARDAR</button>
        <button class="btn btn-pdf" onclick="window.print()">ðŸ“„ PDF / IMPRIMIR</button>
    </div>
</div>

<div id="invoice">
    <div class="header">
        <input type="file" id="logoInput" style="display: none;" accept="image/*" onchange="handleLogo(this)">
        <div class="logo-placeholder" onclick="document.getElementById('logoInput').click()" id="logoContainer">
            <span id="logoText" style="font-size: 9px; color: #999;">CARGAR LOGO</span>
            <img id="logoImg" src="" style="display: none;">
        </div>
        <div class="order-info" style="text-align: right;">
            <div class="order-badge" contenteditable="true">ORDEN DE SERVICIO</div>
            <div style="font-size: 0.85em; margin-top: 5px;">
                <strong>NÂº:</strong> <span contenteditable="true">00001</span><br>
                <strong>Fecha:</strong> <span contenteditable="true">09/02/2026</span>
            </div>
        </div>
    </div>

    <div class="grid-tech">
        <div class="input-card"><label>Cliente / Empresa</label><span class="editable-field" contenteditable="true">&nbsp;</span></div>
        <div class="input-card"><label>TÃ©cnico Responsable</label><span class="editable-field" contenteditable="true">&nbsp;</span></div>
        <div class="input-card span-2"><label>UbicaciÃ³n / DirecciÃ³n Completa</label><span class="editable-field" contenteditable="true">&nbsp;</span></div>
        <div class="input-card"><label>Hora Inicio/Cierre</label><span class="editable-field" contenteditable="true">&nbsp;</span></div>
        <div class="input-card prio-normal" id="priorityCard">
            <label>Prioridad</label>
            <span id="priorityText" style="font-weight: bold; font-size: 0.9em;">NORMAL</span>
        </div>
    </div>

    <div class="info-block">
        <h4>DescripciÃ³n del Trabajo</h4>
        <div class="editable-field" contenteditable="true" style="min-height: 40px;">&nbsp;</div>
    </div>

    <div class="materiales-header">DETALLE DE MATERIALES Y REPUESTOS</div>
    <div class="espacio-blanco" contenteditable="true">&nbsp;</div>

    <div class="info-block" style="border-left-color: var(--warning);">
        <h4>Observaciones y Recomendaciones</h4>
        <div class="editable-field" contenteditable="true" style="min-height: 40px;">&nbsp;</div>
    </div>

    <div class="sig-container">
        <div class="sig-box">Firma TÃ©cnico Responsable<br><strong>IMPETEC</strong></div>
        <div class="sig-box">Firma Conformidad Cliente<br><strong>RECIBIDO</strong></div>
    </div>
</div>

<script>
    window.onload = () => {
        const savedLogo = localStorage.getItem('impetec_logo');
        if (savedLogo) displayLogo(savedLogo);
    };

    function handleLogo(input) {
        const file = input.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                localStorage.setItem('impetec_logo', e.target.result);
                displayLogo(e.target.result);
            };
            reader.readAsDataURL(file);
        }
    }

    function displayLogo(src) {
        document.getElementById('logoImg').src = src;
        document.getElementById('logoImg').style.display = 'block';
        document.getElementById('logoText').style.display = 'none';
        document.getElementById('logoContainer').style.border = 'none';
    }

    function updatePriority() {
        const select = document.getElementById('prioritySelect');
        const card = document.getElementById('priorityCard');
        const text = document.getElementById('priorityText');
        card.className = 'input-card prio-' + select.value;
        text.innerText = select.options[select.selectedIndex].text.toUpperCase();
        const colors = { normal: '#27ae60', basico: '#f1c40f', urgencia: '#e74c3c' };
        text.style.color = colors[select.value];
    }

    function saveHTML() {
        const blob = new Blob([document.documentElement.outerHTML], { type: 'text/html' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'Orden_IMPETEC.html';
        a.click();
    }
</script>
</body>
</html>
